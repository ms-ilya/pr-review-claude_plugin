{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["pr_number", "title", "author", "base_branch", "head_branch", "changed_files", "signature_changes"],
  "properties": {
    "pr_number": {"type": "integer", "minimum": 1},
    "title": {"type": "string"},
    "author": {"type": "string"},
    "base_branch": {"type": "string"},
    "head_branch": {"type": "string"},
    "changed_files": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["path", "change_type", "added_lines", "new_symbols"],
        "properties": {
          "path": {"type": "string"},
          "change_type": {"type": "string", "enum": ["added", "modified", "deleted"]},
          "added_lines": {
            "type": "array",
            "description": "Line numbers as integers or ranges like '42-50'",
            "items": {"oneOf": [{"type": "integer", "minimum": 1}, {"type": "string", "pattern": "^[0-9]+-[0-9]+$"}]}
          },
          "new_symbols": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["type", "name", "line"],
              "properties": {
                "type": {"type": "string", "enum": ["function", "property", "class", "struct", "enum", "protocol", "typealias"]},
                "name": {"type": "string"},
                "line": {"type": "integer", "minimum": 1}
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    },
    "signature_changes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["method", "old_signature", "file", "line", "change_type"],
        "properties": {
          "method": {"type": "string"},
          "old_signature": {"type": "string"},
          "new_signature": {"type": ["string", "null"]},
          "file": {"type": "string"},
          "line": {"type": "integer", "minimum": 1},
          "change_type": {"type": "string", "enum": ["modified", "deleted"]}
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
